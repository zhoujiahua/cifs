{{extend "./layout/layout_a.html"}}

{{block "style"}}
<link rel="stylesheet" href="https://at.alicdn.com/t/font_1304191_c1ubszr5af5.css">
<link rel="stylesheet" href="./../main/css/common.css">

{{/block}}

{{block "content"}}

<!-- main-current -->
{{ include "./tpl/main_current.html" }}

<!-- main-content -->
<div class="main-content">
    <div class="layui-container">
        <div class="layui-row">
            <div class="layui-col-xs3">
                <div class="main-aside">
                    <div class="aside-con aside-subject">
                        <div class="aside-category subject-category">
                            <span>年级：</span>
                            <a href="javascript:;" class="all-item fontactive" id="subjectNo" data-item="1">不限</a>
                        </div>
                        <div class="aside-menu layui-row">
                            <ul class="subject-menu" id="subjectMenu">
                                <li class="layui-col-xs4" data-item="一年级"><a href="javascript:;">一年级</a></li>
                                <li class="layui-col-xs4" data-item="二年级"><a href="javascript:;">二年级</a></li>
                                <li class="layui-col-xs4" data-item="三年级"><a href="javascript:;">三年级</a></li>
                                <li class="layui-col-xs4" data-item="四年级"><a href="javascript:;">四年级</a></li>
                                <li class="layui-col-xs4" data-item="五年级"><a href="javascript:;">五年级</a></li>
                                <li class="layui-col-xs4" data-item="六年级"><a href="javascript:;">六年级</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="aside-con aside-grade">
                        <div class="aside-category grade-category">
                            <span>学科：</span>
                            <a href="javascript:;" class="all-item fontactive" id="gradeNo" data-item="1">不限</a>
                        </div>
                        <div class="aside-menu">
                            <ul class="grade-menu" id="gradeMenu">
                                <li class="layui-col-xs4" data-item="语文"><a href="javascript:;">语文</a></li>
                                <li class="layui-col-xs4" data-item="数学"><a href="javascript:;">数学</a></li>
                                <li class="layui-col-xs4" data-item="英语"><a href="javascript:;">英语</a></li>
                                <li class="layui-col-xs4" data-item="地理"><a href="javascript:;">地理</a></li>
                                <li class="layui-col-xs4" data-item="生物"><a href="javascript:;">生物</a></li>
                                <li class="layui-col-xs4" data-item="化学"><a href="javascript:;">化学</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-xs9">
                <div class="content-con">
                    <div class="con-sort">
                        <span>排序：</span>
                        <a href="javascript:;" class="layui-btn layui-btn-primary layui-btn-xs" data-sort="1"
                            id="viewSort">
                            <i class="iconfont icon-paixu"></i>
                            <span>浏览量</span>
                        </a>
                        <a href="javascript:;" class="layui-btn layui-btn-primary layui-btn-xs" data-sort="1"
                            id="downSort">
                            <i class="iconfont icon-paixu"></i>
                            <span>下载量</span>
                        </a>
                        <a href="javascript:;" class="layui-btn layui-btn-primary layui-btn-xs" data-sort="1"
                            id="timeSort">
                            <i class="iconfont icon-paixu"></i>
                            <span>上传时间</span>
                        </a>
                    </div>
                    <div class="con-list layui-elip">
                        <table class="layui-table layui-elip" lay-skin="nob">
                            <colgroup>
                                <col>
                                <col width="200">
                            </colgroup>
                            <tbody id="commList">
                                <tr>
                                    <td>
                                        <div class="list-title">
                                            <div class="title-icon">
                                                <span class="iconfont icon-geshi_wendangppt"></span>
                                            </div>
                                            <div class="title-con">
                                                <h3 class="title-h">
                                                    <a href="/" class="layui-elip">（精校版）2018年全国卷Ⅱ英语高考试题文档版（含答案） 热点</a>
                                                </h3>
                                                <div class="title-info">
                                                    <span>上传人：张某某</span>
                                                    <span>2019-07-24</span>
                                                    <span>
                                                        <i class="iconfont icon-liulan"></i>
                                                        <b>3625</b>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="list-btn">
                                            <a href="javascript:;" class="dow-btn layui-btn layui-btn-warm">下载</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="list-title">
                                            <div class="title-icon">
                                                <span class="iconfont icon-geshi_wendangppt"></span>
                                            </div>
                                            <div class="title-con">
                                                <h3 class="title-h">
                                                    <a href="/" class="layui-elip">（精校版）2018年全国卷Ⅱ英语高考试题文档版（含答案） 热点</a>
                                                </h3>
                                                <div class="title-info">
                                                    <span>上传人：张某某</span>
                                                    <span>2019-07-24</span>
                                                    <span>
                                                        <i class="iconfont icon-liulan"></i>
                                                        <b>3625</b>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="list-btn">
                                            <a href="javascript:;" class="dow-btn layui-btn layui-btn-warm">下载</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="list-title">
                                            <div class="title-icon">
                                                <span class="iconfont icon-geshi_wendangppt"></span>
                                            </div>
                                            <div class="title-con">
                                                <h3 class="title-h">
                                                    <a href="/" class="layui-elip">（精校版）2018年全国卷Ⅱ英语高考试题文档版（含答案） 热点</a>
                                                </h3>
                                                <div class="title-info">
                                                    <span>上传人：张某某</span>
                                                    <span>2019-07-24</span>
                                                    <span>
                                                        <i class="iconfont icon-liulan"></i>
                                                        <b>3625</b>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="list-btn">
                                            <a href="javascript:;" class="dow-btn layui-btn layui-btn-warm">下载</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="list-title">
                                            <div class="title-icon">
                                                <span class="iconfont icon-geshi_wendangppt"></span>
                                            </div>
                                            <div class="title-con">
                                                <h3 class="title-h">
                                                    <a href="/" class="layui-elip">（精校版）2018年全国卷Ⅱ英语高考试题文档版（含答案） 热点</a>
                                                </h3>
                                                <div class="title-info">
                                                    <span>上传人：张某某</span>
                                                    <span>2019-07-24</span>
                                                    <span>
                                                        <i class="iconfont icon-liulan"></i>
                                                        <b>3625</b>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="list-btn">
                                            <a href="javascript:;" class="dow-btn layui-btn layui-btn-warm">下载</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="list-title">
                                            <div class="title-icon">
                                                <span class="iconfont icon-geshi_wendangppt"></span>
                                            </div>
                                            <div class="title-con">
                                                <h3 class="title-h">
                                                    <a href="/" class="layui-elip">（精校版）2018年全国卷Ⅱ英语高考试题文档版（含答案） 热点</a>
                                                </h3>
                                                <div class="title-info">
                                                    <span>上传人：张某某</span>
                                                    <span>2019-07-24</span>
                                                    <span>
                                                        <i class="iconfont icon-liulan"></i>
                                                        <b>3625</b>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="list-btn">
                                            <a href="javascript:;" class="dow-btn layui-btn layui-btn-warm">下载</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="list-title">
                                            <div class="title-icon">
                                                <span class="iconfont icon-geshi_wendangppt"></span>
                                            </div>
                                            <div class="title-con">
                                                <h3 class="title-h">
                                                    <a href="/" class="layui-elip">（精校版）2018年全国卷Ⅱ英语高考试题文档版（含答案） 热点</a>
                                                </h3>
                                                <div class="title-info">
                                                    <span>上传人：张某某</span>
                                                    <span>2019-07-24</span>
                                                    <span>
                                                        <i class="iconfont icon-liulan"></i>
                                                        <b>3625</b>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="list-btn">
                                            <a href="javascript:;" class="dow-btn layui-btn layui-btn-warm">下载</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="list-title">
                                            <div class="title-icon">
                                                <span class="iconfont icon-geshi_wendangppt"></span>
                                            </div>
                                            <div class="title-con">
                                                <h3 class="title-h">
                                                    <a href="/" class="layui-elip">（精校版）2018年全国卷Ⅱ英语高考试题文档版（含答案） 热点</a>
                                                </h3>
                                                <div class="title-info">
                                                    <span>上传人：张某某</span>
                                                    <span>2019-07-24</span>
                                                    <span>
                                                        <i class="iconfont icon-liulan"></i>
                                                        <b>3625</b>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="list-btn">
                                            <a href="javascript:;" class="dow-btn layui-btn layui-btn-warm">下载</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="list-title">
                                            <div class="title-icon">
                                                <span class="iconfont icon-geshi_wendangppt"></span>
                                            </div>
                                            <div class="title-con">
                                                <h3 class="title-h">
                                                    <a href="/" class="layui-elip">（精校版）2018年全国卷Ⅱ英语高考试题文档版（含答案） 热点</a>
                                                </h3>
                                                <div class="title-info">
                                                    <span>上传人：张某某</span>
                                                    <span>2019-07-24</span>
                                                    <span>
                                                        <i class="iconfont icon-liulan"></i>
                                                        <b>3625</b>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="list-btn">
                                            <a href="javascript:;" class="dow-btn layui-btn layui-btn-warm">下载</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="list-title">
                                            <div class="title-icon">
                                                <span class="iconfont icon-geshi_wendangppt"></span>
                                            </div>
                                            <div class="title-con">
                                                <h3 class="title-h">
                                                    <a href="/" class="layui-elip">（精校版）2018年全国卷Ⅱ英语高考试题文档版（含答案） 热点</a>
                                                </h3>
                                                <div class="title-info">
                                                    <span>上传人：张某某</span>
                                                    <span>2019-07-24</span>
                                                    <span>
                                                        <i class="iconfont icon-liulan"></i>
                                                        <b>3625</b>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="list-btn">
                                            <a href="javascript:;" class="dow-btn layui-btn layui-btn-warm">下载</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="list-title">
                                            <div class="title-icon">
                                                <span class="iconfont icon-geshi_wendangppt"></span>
                                            </div>
                                            <div class="title-con">
                                                <h3 class="title-h">
                                                    <a href="/" class="layui-elip">（精校版）2018年全国卷Ⅱ英语高考试题文档版（含答案） 热点</a>
                                                </h3>
                                                <div class="title-info">
                                                    <span>上传人：张某某</span>
                                                    <span>2019-07-24</span>
                                                    <span>
                                                        <i class="iconfont icon-liulan"></i>
                                                        <b>3625</b>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="list-btn">
                                            <a href="javascript:;" class="dow-btn layui-btn layui-btn-warm">下载</a>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="content-pages ac">
                        <div id="commListPages" class="layui-elip"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{{/block}}

{{block "script"}}
<script src="./../main/js/common.js"></script>
<script>
    layui.use(['layer', 'form', 'laypage'], function () {
        var layer = layui.layer,
            laypage = layui.laypage,
            form = layui.form,
            $ = layui.$,
            indexLoad = null,
            timer = null;

        //年级
        $("#subjectNo").click(function () {
            var item = itemMenu.call(this, "data-item");
            allMenu.call(this, "#subjectMenu li", "fontactive");
            var params = indexParams({});
            //检索数据请求
            searchData(setParams({}));
        })
        $("#subjectMenu").on("click", "li", function () {
            var item = itemMenu.call(this, "data-item");
            elemMenu.call(this, "#subjectNo", "fontactive");
            var params = indexParams({});
            //检索数据请求
            searchData(setParams({}));
        })

        //学科
        $("#gradeNo").click(function () {
            var item = itemMenu.call(this, "data-item");
            allMenu.call(this, "#gradeMenu li", "fontactive");
            var params = indexParams({});
            //检索数据请求
            searchData(setParams({}));
        })
        $("#gradeMenu").on("click", "li", function () {
            var item = itemMenu.call(this, "data-item");
            elemMenu.call(this, "#gradeNo", "fontactive");
            var params = indexParams({});
            //检索数据请求
            searchData(setParams({}));
        })

        //构造参数
        function indexParams(o) {
            return {
                subject: $("#subjectMenu .fontactive").attr("data-item") || 1,
                grade: $("#gradeMenu .fontactive").attr("data-item") || 1,
                page: o.page || 1,
                limit: o.limit || 10,
                viewSort: $("#viewSort").attr("data-sort"),
                timeSort: $("#timeSort").attr("data-sort")
            }
        }

        //菜单参数获取
        function itemMenu(item) {
            if (!item) throw new Error("菜单参数不能为空");
            return $(this).attr(item);
        }

        //菜单选中效果
        function elemMenu(elem, item) {
            if (!item || !elem) throw new Error("选中效果参数不能为空");
            $(elem).removeClass(item);
            $(this).addClass(item).siblings().removeClass(item);
        }

        //不限选中效果
        function allMenu(elem, item) {
            if (!item || !elem) throw new Error("选中效果参数不能为空");
            $(elem).removeClass(item);
            $(this).addClass(item);
        }

        //学科数据请求
        $.getJSON("/api/base/comm/subject", {},
            function (res, textStatus, jqXHR) {
                if (res.code) return console.error("学科栏目请求失败");
                var listHtml = '';
                $.each(res.data, function (k, v) {
                    listHtml += '<li class="layui-col-xs4" data-id=' + v._id + ' data-item="' + v
                        .subject_name + '"><a href="javascript:;">' + v.subject_name + '</a></li>'
                });
                $('#subjectMenu').html(listHtml);
                form.render()
            }
        );

        //年级数据请求
        $.getJSON("/api/base/comm/grade", {},
            function (res, textStatus, jqXHR) {
                if (res.code) return console.error("学科栏目请求失败");
                var listHtml = '';
                $.each(res.data, function (k, v) {
                    listHtml += '<li class="layui-col-xs4" data-id=' + v._id + ' data-item="' + v
                        .grade_name + '"><a href="javascript:;">' + v.grade_name + '</a></li>'
                });
                $('#gradeMenu').html(listHtml);
                console.log(res.data)
                form.render()
            }
        );

        //数据初始化
        searchData(setParams({}));

        //构造参数
        function setParams(o) {
            return {
                page: o.page || 1,
                limit: o.limit || 5,
                subject: $("#subjectMenu .fontactive").attr("data-item") || "",
                grade: $("#gradeMenu .fontactive").attr("data-item") || ""
            }
        }

        //检索数据请求
        function searchData(o) {
            $.ajax({
                type: "GET",
                url: "/api/main/doc/commlist",
                data: o,
                dataType: "json",
                beforeSend: function () {
                    indexLoad = layer.load(1, {
                        shade: [0.6, '#fff']
                    });
                },
                success: function (res) {
                    if (res.code) {
                        timer = setTimeout(function () {
                            layer.close(indexLoad);
                            clearTimeout(timer);
                        }, 800)
                        return $("#commList").html('<h1 style="font-size:16px;margin:30px;">' +
                            res.msg + '</h1>');
                    } else {
                        $("#searchCount").text(res.count);
                        if (!res.count) {
                            timer = setTimeout(function () {
                                layer.close(indexLoad);
                                clearTimeout(timer);
                            }, 800)
                            $("#commList").html('<h1 style="font-size:16px;margin:30px;">' + res
                                .msg + '</h1>');
                            return $("#commListPages").html("");
                        } else if (res.count > o.limit) {
                            laypage.render({ //分页
                                elem: 'commListPages',
                                count: res.count,
                                limit: o.limit,
                                curr: o.page,
                                theme: "#3f53c3",
                                jump: function (obj, first) {
                                    if (first) return false;
                                    searchData(setParams({
                                        page: obj.curr,
                                        limit: obj.limit
                                    }))

                                }
                            });
                            return listHtml(res.data);
                        } else {
                            return listHtml(res.data);
                        }
                    }
                }
            });
        }

        //公共文件列表元素
        function listHtml(d) {
            var commHtml = "";
            $.each(d, function (k, v) {
                commHtml += '<tr data-id=' + v._id + ' class="layui-elip" ><td><div class="list-title"><div class="title-icon"><span class="iconfont icon-geshi_wendangppt"></span></div>\
            <div class="title-con"><h3 class="title-h"><a href="/main/detail/' + v._id +
                    '" target="_blank" class="layui-elip">' + v.titleName + '</a></h3>\
            <div class="title-info layui-elip"><span>上传人：' + v.authorName + ' </span><span>' + moment(v.createDate)
                    .format("YYYY-MM-DD HH:mm:ss") + '</span><span>学科：' + v.subjectName +
                    '</span><span>年级：' + v.gradeName + '</span>\
            <span><i class="iconfont icon-liulan"></i><b>' + v.downloads + '</b></span></div></div></div></td>\
             <td><div class="list-btn"><a href="/main/detail/' + v._id +
                    '" target="_blank" class="dow-btn layui-btn layui-btn-warm">查看</a></div></td></tr>';
            });
            $("#commList").html(commHtml);
            timer = setTimeout(function () {
                layer.close(indexLoad);
                clearTimeout(timer);
            }, 800)
        }

    })
</script>
{{/block}}